<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" >
    <link href="/style.css" rel="stylesheet">
    <title>Document</title>
</head>
<body>
    <nav>
        <a href="/">HOME</a>
        {{!-- <button type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span>TOGGLE!</span>
        </button> --}}
        <div id="navbarNavAltMarkup">
            <div id="opts">
            </div>
        </div>
    </nav>
    {{{body}}}
    <script>
        const selector = document.querySelector("#opts");

        const isOnline = async () => {
        try {
            const opts = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            };
            const url = "/api/auth/online";
            let response = await fetch(url, opts);
            response = await response.json();
            console.log(response);
            if (response.error) {
            selector.innerHTML = `
            <a class="btn btn-success py-1 px-2 m-1" href="/register">Register</a>
            <a class="btn btn-success py-1 px-2 m-1" href="/login">Login</a>
            `;
            } else {
            selector.innerHTML = `
            <a class="btn btn-success py-1 px-2 m-1" href="/profile">Profile</a>
            <a class="btn btn-success py-1 px-2 m-1" href="/cart">Cart</a>
            <button class="btn btn-success py-1 px-2 m-1" id="signout">Sign out</button>
            `;
        document.querySelector("#signout").addEventListener("click", async () => {
        try {
            const opts = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            };
            const url = "/api/auth/signout";
            await fetch(url, opts);
            localStorage.removeItem("token");
            location.replace("/");
        } catch (error) {
            console.log(error);
        }
        });
            }
            
        } catch (error) {
            console.log(error);
        }
        };

        isOnline();

    </script>
</body>
</html>